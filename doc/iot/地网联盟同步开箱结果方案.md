# 地网联盟同步开箱结果方案
> 作者：李允智 
> 时间： 2020-09-07
> 版本：1.1

## 前言
本文档是为了解决递易与地网联盟取件后，在开箱失败的情况未通知到地网联盟的情况，导致在下次取件的时候就不能使用取件码的问题。在经过递易讨论后，为地网联盟提供同步和异步通知开箱结果方案，让开箱结果递易和地网联盟保持一致。

## 1、同步接口
> 地网联盟主动调用递易接口，来查看取件码取件后，格口开启的情况

#### 接口请求入参
> 请求地址：BasicService/SmartBox/CheckOpenStatus/

| 参数名         | 必选 | 类型   | 说明     |
| :------------- | :--- | :----- | -------- |
| SubsidiaryCode       | 是   | string | 副柜编号 |
| SubsidiaryBoxCode       | 是   | string | 副柜格口编号 |

> 设备号等基础参数，签名方式同原来对接方案

#### 接口请求出参

| 参数名           | 类型    | 说明         |
| :--------------- | :------ | ------------ |
| Data - OpenStatus | int    | 开启状态 |
| Code             | integer | 返回状态码   |
| Message          | string  | 错误提示     |

> OpenStatus
> - 未开 0 
> - 已开 1

## 2、异步接口
> 递易当接收到了柜机格口打开的消息后通知地网联盟，主动调用地网联盟接口告知格口已开

#### 接口请求入参
> 请求地址：地网联盟提供

| 参数名         | 必选 | 类型   | 说明     |
| :------------- | :--- | :----- | -------- |
| MchID       | 是   | string | 商户ID |
| DeviceSn       | 是   | string | 设备号 |
| DeviceType       | 是   | string | 设备类型 |
| Nonce       | 是   | string | 随机数 |
| ReqTime       | 是   | string | 请求时间 |
| OpenId       | 是   | string | 开启ID |

> 签名方式同原来对接方案
> 匹配规则：递易按 设备号+副柜号+副柜格口号+OpenId 来匹配开启

#### 接口请求出参

> 由地网联盟提供

## 3、OpenBox接口增加入参
> 增加OpenId来识别开启格口唯一标志

#### 接口请求入参
> 请求地址：BasicService/SmartBox/OpenBox/

| 参数名         | 必选 | 类型   | 说明     |
| :------------- | :--- | :----- | -------- |
| OpenId       | 是   | string | 打开ID |

> OpenId为10位以内的随机数

#### 接口请求出参

| 参数名           | 类型    | 说明         |
| :--------------- | :------ | ------------ |
| Code             | integer | 返回状态码   |
| Message          | string  | 错误提示     |

> Code状态码为
> - 成功 200
> - 失败 0